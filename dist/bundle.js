!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n,o=function(){function t(t,e){this.x=t,this.y=e,this.nextField=void 0}return t.prototype.detectCollision=function(t){return this.x===t.x&&this.y===t.y},t}();!function(t){t[t.UP=0]="UP",t[t.RIGHT=1]="RIGHT",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT"}(n||(n={}));var r,s=function(){function t(){}return t.GAME_WIDTH=20,t.GAME_HEIGHT=20,t.FIELD_SIZE=20,t}(),h=function(){function t(t){this.head=new o(2,7),this.tail=[],this.size=0,this.game=t}return t.prototype.draw=function(t){t.fillStyle="red",this.drawField(this.head,t,s.FIELD_SIZE);for(var e=0;e<this.tail.length;e++)this.drawField(this.tail[e],t,s.FIELD_SIZE)},t.prototype.changeDirection=function(t){t===n.LEFT&&this.direction===n.RIGHT||t===n.UP&&this.direction===n.DOWN||t===n.DOWN&&this.direction===n.UP||t===n.RIGHT&&this.direction===n.LEFT||(this.direction=t)},t.prototype.move=function(){void 0!==this.direction&&(this.tail.push(this.head),this.head=this.getNext(),this.head.detectCollision(this.game.food)&&(this.size++,this.game.snakeFoundFood()),this.tail.length>this.size&&this.tail.splice(0,1))},t.prototype.fieldsAreEmpty=function(t){var e=!1;this.head.detectCollision(t)&&(e=!0);for(var i=0;i<this.tail.length;i++)this.tail[i].detectCollision(t)&&(e=!0);return e},t.prototype.snakeSlidesIntoItself=function(){for(var t=0;t<this.tail.length;t++)if(this.head.detectCollision(this.tail[t]))return!0;return!1},t.prototype.getNext=function(){switch(this.direction){case n.UP:return this.head.y-1<1?new o(this.head.x,s.GAME_HEIGHT):new o(this.head.x,this.head.y-1);case n.RIGHT:return this.head.x+1>s.GAME_WIDTH?new o(1,this.head.y):new o(this.head.x+1,this.head.y);case n.DOWN:return this.head.y===s.GAME_HEIGHT?new o(this.head.x,1):new o(this.head.x,this.head.y+1);case n.LEFT:return this.head.x-1==0?new o(s.GAME_WIDTH,this.head.y):new o(this.head.x-1,this.head.y)}},t.prototype.drawField=function(t,e,i){e.fillRect((t.x-1)*i,(t.y-1)*i,i,i)},t}(),a=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.draw=function(t){t.fillStyle="green",t.fillRect((this.x-1)*s.FIELD_SIZE,(this.y-1)*s.FIELD_SIZE,s.FIELD_SIZE,s.FIELD_SIZE)},e}(o);i.d(e,"SnakeGame",function(){return d});var d=function(){function t(){var t=this,e=document.getElementById("snake");this.ctx=e.getContext("2d"),this.startNewGame(),setInterval(function(){t.nextStep()},100),this.keyboardInput()}return t.prototype.nextStep=function(){this.snake.move(),this.draw()},t.prototype.gameOver=function(){},t.prototype.snakeFoundFood=function(){this.placeNewFood(),this.increaseScore()},t.prototype.startNewGame=function(){this.snake=new h(this),this.food=new c(4,4),this.draw(),this.score=0},t.prototype.placeNewFood=function(){for(var t=Math.floor(Math.random()*(s.GAME_WIDTH-1+1))+1,e=Math.floor(Math.random()*(s.GAME_HEIGHT-1+1))+1,i=new c(t,e);this.snake.fieldsAreEmpty(i);)t=Math.floor(Math.random()*(s.GAME_WIDTH-1+1))+1,e=Math.floor(Math.random()*(s.GAME_HEIGHT-1+1))+1,i=new c(t,e);this.food=i,console.log(this.food)},t.prototype.increaseScore=function(){this.score++},t.prototype.draw=function(){this.ctx.fillStyle="grey",this.ctx.fillRect(0,0,s.GAME_WIDTH*s.FIELD_SIZE,s.GAME_HEIGHT*s.FIELD_SIZE),this.food.draw(this.ctx),this.snake.draw(this.ctx)},t.prototype.keyboardInput=function(){var t=this;document.addEventListener("keydown",function(e){37===e.keyCode?t.snake.changeDirection(n.LEFT):38===e.keyCode?t.snake.changeDirection(n.UP):39===e.keyCode?t.snake.changeDirection(n.RIGHT):40===e.keyCode&&t.snake.changeDirection(n.DOWN)})},t}();new d}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2ZpZWxkLnRzIiwid2VicGFjazovLy8uL3NyYy9kaXJlY3Rpb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbnN0YW50LnRzIiwid2VicGFjazovLy8uL3NyYy9zbmFrZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZm9vZC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvc25ha2VfZ2FtZS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJ2YWx1ZSIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiRGlyZWN0aW9uIiwiRmllbGQiLCJ4IiwieSIsInRoaXMiLCJuZXh0RmllbGQiLCJ1bmRlZmluZWQiLCJkZXRlY3RDb2xsaXNpb24iLCJmaWVsZCIsIkNvbnN0YW50IiwiR0FNRV9XSURUSCIsIkdBTUVfSEVJR0hUIiwiRklFTERfU0laRSIsInNuYWtlX1NuYWtlIiwiU25ha2UiLCJnYW1lIiwiaGVhZCIsInRhaWwiLCJzaXplIiwiZHJhdyIsImN0eCIsImZpbGxTdHlsZSIsImRyYXdGaWVsZCIsImxlbmd0aCIsImNoYW5nZURpcmVjdGlvbiIsImRpcmVjdGlvbiIsIkxFRlQiLCJSSUdIVCIsIlVQIiwiRE9XTiIsIm1vdmUiLCJwdXNoIiwiZ2V0TmV4dCIsImZvb2QiLCJzbmFrZUZvdW5kRm9vZCIsInNwbGljZSIsImZpZWxkc0FyZUVtcHR5IiwiY29sbGlzaW9uIiwic25ha2VTbGlkZXNJbnRvSXRzZWxmIiwic25ha2VQYXJ0IiwiZmlsbFJlY3QiLCJmb29kX0Zvb2QiLCJfc3VwZXIiLCJGb29kIiwiX19leHRlbmRzIiwic25ha2VfZ2FtZV9TbmFrZUdhbWUiLCJTbmFrZUdhbWUiLCJfdGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0Iiwic3RhcnROZXdHYW1lIiwic2V0SW50ZXJ2YWwiLCJuZXh0U3RlcCIsImtleWJvYXJkSW5wdXQiLCJzbmFrZSIsImdhbWVPdmVyIiwicGxhY2VOZXdGb29kIiwiaW5jcmVhc2VTY29yZSIsInNjb3JlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY29uc29sZSIsImxvZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleUNvZGUiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxHQUNBSyxjQUFBLEVBQ0FDLFlBQUEsRUFDQUMsSUFBQU4sS0FNQVosRUFBQW1CLEVBQUEsU0FBQWpCLEdBQ0FZLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURrQixPQUFBLEtBSWpEcEIsRUFBQXFCLEVBQUEsU0FBQWxCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQW1CLFdBQ0EsV0FBMkIsT0FBQW5CLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUgsRUFBQVUsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBWixFQUFBYSxFQUFBLFNBQUFVLEVBQUFDLEdBQXNELE9BQUFWLE9BQUFXLFVBQUFDLGVBQUFuQixLQUFBZ0IsRUFBQUMsSUFHdER4QixFQUFBMkIsRUFBQSxHQUlBM0IsSUFBQTRCLEVBQUEseUNDbkVBLElDQVlDLEVEQVpDLEVBQUEsV0FLSSxTQUFBQSxFQUFZQyxFQUFZQyxHQUNwQkMsS0FBS0YsRUFBSUEsRUFDVEUsS0FBS0QsRUFBSUEsRUFDVEMsS0FBS0MsZUFBWUMsRUFNekIsT0FIV0wsRUFBQUwsVUFBQVcsZ0JBQVAsU0FBdUJDLEdBQ25CLE9BQVFKLEtBQUtGLElBQU1NLEVBQU1OLEdBQUtFLEtBQUtELElBQU1LLEVBQU1MLEdBRXZERixFQWRBLElDQUEsU0FBWUQsR0FDUkEsSUFBQSxXQUNBQSxJQUFBLGlCQUNBQSxJQUFBLGVBQ0FBLElBQUEsZUFKSixDQUFZQSxXQ0FaLE1BQUFTLEVBQUEsb0JBQUFBLEtBSUEsT0FIb0JBLEVBQUFDLFdBQXNCLEdBQ3RCRCxFQUFBRSxZQUF1QixHQUN2QkYsRUFBQUcsV0FBc0IsR0FDMUNILEVBSkEsR0NLQUksRUFBQSxXQU9JLFNBQUFDLEVBQVlDLEdBQ1JYLEtBQUtZLEtBQU8sSUFBSWYsRUFBTSxFQUFHLEdBQ3pCRyxLQUFLYSxRQUNMYixLQUFLYyxLQUFPLEVBQ1pkLEtBQUtXLEtBQU9BLEVBd0dwQixPQXJHV0QsRUFBQWxCLFVBQUF1QixLQUFQLFNBQVlDLEdBQ1JBLEVBQUlDLFVBQVksTUFDaEJqQixLQUFLa0IsVUFBVWxCLEtBQUtZLEtBQU1JLEVBQUtYLEVBQVNHLFlBQ3hDLElBQUksSUFBSXJDLEVBQVksRUFBR0EsRUFBSTZCLEtBQUthLEtBQUtNLE9BQVFoRCxJQUN6QzZCLEtBQUtrQixVQUFVbEIsS0FBS2EsS0FBSzFDLEdBQUk2QyxFQUFLWCxFQUFTRyxhQUk1Q0UsRUFBQWxCLFVBQUE0QixnQkFBUCxTQUF1QkMsR0FDaEJBLElBQWN6QixFQUFVMEIsTUFBUXRCLEtBQUtxQixZQUFjekIsRUFBVTJCLE9BRXJERixJQUFjekIsRUFBVTRCLElBQU14QixLQUFLcUIsWUFBY3pCLEVBQVU2QixNQUUzREosSUFBY3pCLEVBQVU2QixNQUFRekIsS0FBS3FCLFlBQWN6QixFQUFVNEIsSUFFN0RILElBQWN6QixFQUFVMkIsT0FBU3ZCLEtBQUtxQixZQUFjekIsRUFBVTBCLE9BR3pFdEIsS0FBS3FCLFVBQVlBLElBR2RYLEVBQUFsQixVQUFBa0MsS0FBUCxnQkFDMEJ4QixJQUFuQkYsS0FBS3FCLFlBSVJyQixLQUFLYSxLQUFLYyxLQUFLM0IsS0FBS1ksTUFHcEJaLEtBQUtZLEtBQU9aLEtBQUs0QixVQUVkNUIsS0FBS1ksS0FBS1QsZ0JBQWdCSCxLQUFLVyxLQUFLa0IsUUFDbkM3QixLQUFLYyxPQUNMZCxLQUFLVyxLQUFLbUIsa0JBSVY5QixLQUFLYSxLQUFLTSxPQUFTbkIsS0FBS2MsTUFDeEJkLEtBQUthLEtBQUtrQixPQUFPLEVBQUcsS0FJckJyQixFQUFBbEIsVUFBQXdDLGVBQVAsU0FBc0I1QixHQUNsQixJQUFJNkIsR0FBc0IsRUFFdkJqQyxLQUFLWSxLQUFLVCxnQkFBZ0JDLEtBQ3pCNkIsR0FBWSxHQUdoQixJQUFJLElBQUk5RCxFQUFZLEVBQUdBLEVBQUk2QixLQUFLYSxLQUFLTSxPQUFRaEQsSUFDdEM2QixLQUFLYSxLQUFLMUMsR0FBR2dDLGdCQUFnQkMsS0FDNUI2QixHQUFZLEdBSXBCLE9BQU9BLEdBSUh2QixFQUFBbEIsVUFBQTBDLHNCQUFSLFdBQ0ksSUFBSSxJQUFJL0QsRUFBWSxFQUFHQSxFQUFJNkIsS0FBS2EsS0FBS00sT0FBUWhELElBQ3pDLEdBQUc2QixLQUFLWSxLQUFLVCxnQkFBZ0JILEtBQUthLEtBQUsxQyxJQUNuQyxPQUFPLEVBSWYsT0FBTyxHQUdIdUMsRUFBQWxCLFVBQUFvQyxRQUFSLFdBQ0ksT0FBUTVCLEtBQUtxQixXQUNULEtBQUt6QixFQUFVNEIsR0FDWCxPQUFHeEIsS0FBS1ksS0FBS2IsRUFBSSxFQUFJLEVBQ1YsSUFBSUYsRUFBTUcsS0FBS1ksS0FBS2QsRUFBR08sRUFBU0UsYUFFaEMsSUFBSVYsRUFBTUcsS0FBS1ksS0FBS2QsRUFBR0UsS0FBS1ksS0FBS2IsRUFBSSxHQUVwRCxLQUFLSCxFQUFVMkIsTUFDWCxPQUFHdkIsS0FBS1ksS0FBS2QsRUFBSSxFQUFJTyxFQUFTQyxXQUNuQixJQUFJVCxFQUFNLEVBQUdHLEtBQUtZLEtBQUtiLEdBRXZCLElBQUlGLEVBQU1HLEtBQUtZLEtBQUtkLEVBQUksRUFBR0UsS0FBS1ksS0FBS2IsR0FFcEQsS0FBS0gsRUFBVTZCLEtBQ1gsT0FBR3pCLEtBQUtZLEtBQUtiLElBQU1NLEVBQVNFLFlBQ2pCLElBQUlWLEVBQU1HLEtBQUtZLEtBQUtkLEVBQUcsR0FFdkIsSUFBSUQsRUFBTUcsS0FBS1ksS0FBS2QsRUFBR0UsS0FBS1ksS0FBS2IsRUFBSSxHQUVwRCxLQUFLSCxFQUFVMEIsS0FDWCxPQUFHdEIsS0FBS1ksS0FBS2QsRUFBSSxHQUFNLEVBQ1osSUFBSUQsRUFBTVEsRUFBU0MsV0FBWU4sS0FBS1ksS0FBS2IsR0FFekMsSUFBSUYsRUFBTUcsS0FBS1ksS0FBS2QsRUFBRSxFQUFHRSxLQUFLWSxLQUFLYixLQUtsRFcsRUFBQWxCLFVBQUEwQixVQUFSLFNBQWtCaUIsRUFBa0JuQixFQUErQkYsR0FDL0RFLEVBQUlvQixVQUFVRCxFQUFVckMsRUFBSSxHQUFLZ0IsR0FBT3FCLEVBQVVwQyxFQUFJLEdBQUtlLEVBQU1BLEVBQU1BLElBRS9FSixFQW5IQSx5UkNGQTJCLEVBQUEsU0FBQUMsR0FBQSxTQUFBQyxtREFLQSxPQUwwQkMsRUFBQUQsRUFBQUQsR0FDZkMsRUFBQS9DLFVBQUF1QixLQUFQLFNBQVlDLEdBQ1JBLEVBQUlDLFVBQVksUUFDaEJELEVBQUlvQixVQUFVcEMsS0FBS0YsRUFBSSxHQUFLTyxFQUFTRyxZQUFhUixLQUFLRCxFQUFJLEdBQUtNLEVBQVNHLFdBQVdILEVBQVNHLFdBQVlILEVBQVNHLGFBRTFIK0IsRUFMQSxDQUEwQjFDLDJDQ0UxQixJQUFBNEMsRUFBQSxXQU1JLFNBQUFDLElBQUEsSUFBQUMsRUFBQTNDLEtBQ1E0QyxFQUFpREMsU0FBU0MsZUFBZSxTQUM3RTlDLEtBQUtnQixJQUFNNEIsRUFBT0csV0FBVyxNQUU3Qi9DLEtBQUtnRCxlQUVMQyxZQUFZLFdBQ1JOLEVBQUtPLFlBQ04sS0FDSGxELEtBQUttRCxnQkErRGIsT0E1RFdULEVBQUFsRCxVQUFBMEQsU0FBUCxXQUNJbEQsS0FBS29ELE1BQU0xQixPQUNYMUIsS0FBS2UsUUFHRjJCLEVBQUFsRCxVQUFBNkQsU0FBUCxhQUlPWCxFQUFBbEQsVUFBQXNDLGVBQVAsV0FDSTlCLEtBQUtzRCxlQUNMdEQsS0FBS3VELGlCQUdGYixFQUFBbEQsVUFBQXdELGFBQVAsV0FDSWhELEtBQUtvRCxNQUFRLElBQUkzQyxFQUFNVCxNQUN2QkEsS0FBSzZCLEtBQU8sSUFBSVEsRUFBSyxFQUFHLEdBQ3hCckMsS0FBS2UsT0FDTGYsS0FBS3dELE1BQVEsR0FHVGQsRUFBQWxELFVBQUE4RCxhQUFSLFdBS0ksSUFKQSxJQUFJeEQsRUFBYTJELEtBQUtDLE1BQU1ELEtBQUtFLFVBQVl0RCxFQUFTQyxXQUFhLEVBQUksSUFBTSxFQUN6RVAsRUFBYTBELEtBQUtDLE1BQU1ELEtBQUtFLFVBQVl0RCxFQUFTRSxZQUFjLEVBQUksSUFBTSxFQUMxRXNCLEVBQWMsSUFBSVEsRUFBS3ZDLEVBQUdDLEdBRXhCQyxLQUFLb0QsTUFBTXBCLGVBQWVILElBQzVCL0IsRUFBSTJELEtBQUtDLE1BQU1ELEtBQUtFLFVBQVl0RCxFQUFTQyxXQUFhLEVBQUksSUFBTSxFQUNoRVAsRUFBSTBELEtBQUtDLE1BQU1ELEtBQUtFLFVBQVl0RCxFQUFTRSxZQUFjLEVBQUksSUFBTSxFQUNqRXNCLEVBQU8sSUFBSVEsRUFBS3ZDLEVBQUdDLEdBR3ZCQyxLQUFLNkIsS0FBT0EsRUFDWitCLFFBQVFDLElBQUk3RCxLQUFLNkIsT0FHYmEsRUFBQWxELFVBQUErRCxjQUFSLFdBQ0l2RCxLQUFLd0QsU0FHRGQsRUFBQWxELFVBQUF1QixLQUFSLFdBQ0lmLEtBQUtnQixJQUFJQyxVQUFZLE9BQ3JCakIsS0FBS2dCLElBQUlvQixTQUFTLEVBQUcsRUFBRy9CLEVBQVNDLFdBQWFELEVBQVNHLFdBQVlILEVBQVNFLFlBQWNGLEVBQVNHLFlBQ25HUixLQUFLNkIsS0FBS2QsS0FBS2YsS0FBS2dCLEtBQ3BCaEIsS0FBS29ELE1BQU1yQyxLQUFLZixLQUFLZ0IsTUFHakIwQixFQUFBbEQsVUFBQTJELGNBQVIsZUFBQVIsRUFBQTNDLEtBQ0k2QyxTQUFTaUIsaUJBQWlCLFVBQVcsU0FBQ0MsR0FDWixLQUFsQkEsRUFBTUMsUUFDVnJCLEVBQUtTLE1BQU1oQyxnQkFBZ0J4QixFQUFVMEIsTUFDUixLQUFsQnlDLEVBQU1DLFFBQ2JyQixFQUFLUyxNQUFNaEMsZ0JBQWdCeEIsRUFBVTRCLElBQ1osS0FBbEJ1QyxFQUFNQyxRQUNickIsRUFBS1MsTUFBTWhDLGdCQUFnQnhCLEVBQVUyQixPQUNaLEtBQWxCd0MsRUFBTUMsU0FDYnJCLEVBQUtTLE1BQU1oQyxnQkFBZ0J4QixFQUFVNkIsU0FJckRpQixFQTlFQSxHQWdGdUIsSUFBSUQiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBjbGFzcyBGaWVsZCB7XHJcbiAgICBwdWJsaWMgbmV4dEZpZWxkIDogRmllbGQ7XHJcbiAgICBwdWJsaWMgeCA6IG51bWJlcjtcclxuICAgIHB1YmxpYyB5IDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHggOiBudW1iZXIsIHkgOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnggPSB4O1xyXG4gICAgICAgIHRoaXMueSA9IHk7XHJcbiAgICAgICAgdGhpcy5uZXh0RmllbGQgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRldGVjdENvbGxpc2lvbihmaWVsZDogRmllbGQpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMueCA9PT0gZmllbGQueCAmJiB0aGlzLnkgPT09IGZpZWxkLnkpO1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGVudW0gRGlyZWN0aW9uIHtcclxuICAgIFVQLFxyXG4gICAgUklHSFQsXHJcbiAgICBET1dOLFxyXG4gICAgTEVGVFxyXG59IiwiZXhwb3J0IGNsYXNzIENvbnN0YW50IHtcclxuICAgIHN0YXRpYyByZWFkb25seSBHQU1FX1dJRFRIIDogbnVtYmVyID0gMjA7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgR0FNRV9IRUlHSFQgOiBudW1iZXIgPSAyMDtcclxuICAgIHN0YXRpYyByZWFkb25seSBGSUVMRF9TSVpFIDogbnVtYmVyID0gMjA7XHJcbn0iLCJpbXBvcnQgeyBGaWVsZCB9IGZyb20gXCIuL2ZpZWxkXCI7XHJcbmltcG9ydCB7IERpcmVjdGlvbiB9IGZyb20gXCIuL2RpcmVjdGlvblwiO1xyXG5pbXBvcnQgeyBTbmFrZUdhbWUgfSBmcm9tIFwiLi9zbmFrZV9nYW1lXCI7XHJcbmltcG9ydCB7IENvbnN0YW50IH0gZnJvbSBcIi4vY29uc3RhbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTbmFrZSB7XHJcbiAgICBwcml2YXRlIGdhbWUgOiBTbmFrZUdhbWU7XHJcbiAgICBwcml2YXRlIGhlYWQgOiBGaWVsZDtcclxuICAgIHByaXZhdGUgdGFpbCA6IEZpZWxkW107XHJcbiAgICBwcml2YXRlIHNpemUgOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGRpcmVjdGlvbjogRGlyZWN0aW9uO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGdhbWU6IFNuYWtlR2FtZSkge1xyXG4gICAgICAgIHRoaXMuaGVhZCA9IG5ldyBGaWVsZCgyLCA3KTtcclxuICAgICAgICB0aGlzLnRhaWwgPSBbXTtcclxuICAgICAgICB0aGlzLnNpemUgPSAwO1xyXG4gICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcoY3R4IDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTogdm9pZCB7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmVkXCI7XHJcbiAgICAgICAgdGhpcy5kcmF3RmllbGQodGhpcy5oZWFkLCBjdHgsIENvbnN0YW50LkZJRUxEX1NJWkUpO1xyXG4gICAgICAgIGZvcih2YXIgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMudGFpbC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdGaWVsZCh0aGlzLnRhaWxbaV0sIGN0eCwgQ29uc3RhbnQuRklFTERfU0laRSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjaGFuZ2VEaXJlY3Rpb24oZGlyZWN0aW9uOiBEaXJlY3Rpb24pOiB2b2lkIHtcclxuICAgICAgICBpZihkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5MRUZUICYmIHRoaXMuZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uUklHSFQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uVVAgJiYgdGhpcy5kaXJlY3Rpb24gPT09IERpcmVjdGlvbi5ET1dOKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLkRPV04gJiYgdGhpcy5kaXJlY3Rpb24gPT09IERpcmVjdGlvbi5VUCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5SSUdIVCAmJiB0aGlzLmRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLkxFRlQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbW92ZSgpOiB2b2lkIHtcclxuICAgICAgICBpZih0aGlzLmRpcmVjdGlvbiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkIGN1cnJlbnQgaGVhZCB0byB0YWlsXHJcbiAgICAgICAgdGhpcy50YWlsLnB1c2godGhpcy5oZWFkKTtcclxuXHJcbiAgICAgICAgLy8gZ2V0IG5leHQgcG9zaXRpb25cclxuICAgICAgICB0aGlzLmhlYWQgPSB0aGlzLmdldE5leHQoKTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5oZWFkLmRldGVjdENvbGxpc2lvbih0aGlzLmdhbWUuZm9vZCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zaXplKys7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5zbmFrZUZvdW5kRm9vZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZml4IHRoZSB3b3JtIHNpemVcclxuICAgICAgICBpZiAodGhpcy50YWlsLmxlbmd0aCA+IHRoaXMuc2l6ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnRhaWwuc3BsaWNlKDAsIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZmllbGRzQXJlRW1wdHkoZmllbGQ6IEZpZWxkKTogYm9vbGVhbiB7XHJcbiAgICAgICAgdmFyIGNvbGxpc2lvbiA6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5oZWFkLmRldGVjdENvbGxpc2lvbihmaWVsZCkpIHtcclxuICAgICAgICAgICAgY29sbGlzaW9uID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvcih2YXIgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMudGFpbC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZih0aGlzLnRhaWxbaV0uZGV0ZWN0Q29sbGlzaW9uKGZpZWxkKSkge1xyXG4gICAgICAgICAgICAgICAgY29sbGlzaW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbGxpc2lvbjtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBzbmFrZVNsaWRlc0ludG9JdHNlbGYoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgZm9yKHZhciBpOiBudW1iZXIgPSAwOyBpIDwgdGhpcy50YWlsLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaGVhZC5kZXRlY3RDb2xsaXNpb24odGhpcy50YWlsW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE5leHQoKTogRmllbGQge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY2FzZSBEaXJlY3Rpb24uVVA6XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmhlYWQueSAtIDEgPCAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZCh0aGlzLmhlYWQueCwgQ29uc3RhbnQuR0FNRV9IRUlHSFQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMuaGVhZC54LCB0aGlzLmhlYWQueSAtIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5SSUdIVDpcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaGVhZC54ICsgMSA+IENvbnN0YW50LkdBTUVfV0lEVEgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKDEsIHRoaXMuaGVhZC55KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZCh0aGlzLmhlYWQueCArIDEsIHRoaXMuaGVhZC55KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBEaXJlY3Rpb24uRE9XTjpcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaGVhZC55ID09PSBDb25zdGFudC5HQU1FX0hFSUdIVCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQodGhpcy5oZWFkLngsIDEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMuaGVhZC54LCB0aGlzLmhlYWQueSArIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5MRUZUOlxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5oZWFkLnggLSAxID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZChDb25zdGFudC5HQU1FX1dJRFRILCB0aGlzLmhlYWQueSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQodGhpcy5oZWFkLngtMSwgdGhpcy5oZWFkLnkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXdGaWVsZChzbmFrZVBhcnQ6IEZpZWxkLCBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgc2l6ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgY3R4LmZpbGxSZWN0KChzbmFrZVBhcnQueCAtIDEpICogc2l6ZSwgKHNuYWtlUGFydC55IC0gMSkgKiBzaXplLCBzaXplLCBzaXplKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IEZpZWxkIH0gZnJvbSBcIi4vZmllbGRcIjtcclxuaW1wb3J0IHsgQ29uc3RhbnQgfSBmcm9tIFwiLi9jb25zdGFudFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZvb2QgZXh0ZW5kcyBGaWVsZCB7XHJcbiAgICBwdWJsaWMgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6dm9pZCB7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwiZ3JlZW5cIjtcclxuICAgICAgICBjdHguZmlsbFJlY3QoKHRoaXMueCAtIDEpICogQ29uc3RhbnQuRklFTERfU0laRSwgKHRoaXMueSAtIDEpICogQ29uc3RhbnQuRklFTERfU0laRSxDb25zdGFudC5GSUVMRF9TSVpFLCBDb25zdGFudC5GSUVMRF9TSVpFKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFNuYWtlIH0gZnJvbSBcIi4vc25ha2VcIjtcclxuaW1wb3J0IHsgRm9vZCB9IGZyb20gXCIuL2Zvb2RcIjtcclxuaW1wb3J0IHsgRGlyZWN0aW9uIH0gZnJvbSBcIi4vZGlyZWN0aW9uXCI7XHJcbmltcG9ydCB7IENvbnN0YW50IH0gZnJvbSBcIi4vY29uc3RhbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTbmFrZUdhbWUge1xyXG4gICAgcHVibGljIGZvb2QgOiBGb29kO1xyXG4gICAgcHJpdmF0ZSBzbmFrZSA6IFNuYWtlO1xyXG4gICAgcHJpdmF0ZSBjdHggOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgICBwcml2YXRlIHNjb3JlIDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHZhciBjYW52YXMgOiBIVE1MQ2FudmFzRWxlbWVudCA9IDxIVE1MQ2FudmFzRWxlbWVudD4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzbmFrZVwiKTtcclxuICAgICAgICB0aGlzLmN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgICAgIHRoaXMuc3RhcnROZXdHYW1lKCk7XHJcblxyXG4gICAgICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5uZXh0U3RlcCgpO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgdGhpcy5rZXlib2FyZElucHV0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5leHRTdGVwKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc25ha2UubW92ZSgpO1xyXG4gICAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnYW1lT3ZlcigpOiB2b2lkIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNuYWtlRm91bmRGb29kKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucGxhY2VOZXdGb29kKCk7XHJcbiAgICAgICAgdGhpcy5pbmNyZWFzZVNjb3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0TmV3R2FtZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNuYWtlID0gbmV3IFNuYWtlKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZm9vZCA9IG5ldyBGb29kKDQsIDQpO1xyXG4gICAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgICAgIHRoaXMuc2NvcmUgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGxhY2VOZXdGb29kKCk6IHZvaWQge1xyXG4gICAgICAgIHZhciB4IDogbnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKENvbnN0YW50LkdBTUVfV0lEVEggLSAxICsgMSkpICsgMTtcclxuICAgICAgICB2YXIgeSA6IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChDb25zdGFudC5HQU1FX0hFSUdIVCAtIDEgKyAxKSkgKyAxO1xyXG4gICAgICAgIHZhciBmb29kIDogRm9vZCA9IG5ldyBGb29kKHgsIHkpO1xyXG5cclxuICAgICAgICB3aGlsZSh0aGlzLnNuYWtlLmZpZWxkc0FyZUVtcHR5KGZvb2QpKSB7XHJcbiAgICAgICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoQ29uc3RhbnQuR0FNRV9XSURUSCAtIDEgKyAxKSkgKyAxO1xyXG4gICAgICAgICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKENvbnN0YW50LkdBTUVfSEVJR0hUIC0gMSArIDEpKSArIDE7XHJcbiAgICAgICAgICAgIGZvb2QgPSBuZXcgRm9vZCh4LCB5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZm9vZCA9IGZvb2Q7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5mb29kKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluY3JlYXNlU2NvcmUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zY29yZSsrO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZHJhdygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBcImdyZXlcIjtcclxuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCgwLCAwLCBDb25zdGFudC5HQU1FX1dJRFRIICogQ29uc3RhbnQuRklFTERfU0laRSwgQ29uc3RhbnQuR0FNRV9IRUlHSFQgKiBDb25zdGFudC5GSUVMRF9TSVpFKTtcclxuICAgICAgICB0aGlzLmZvb2QuZHJhdyh0aGlzLmN0eCk7XHJcbiAgICAgICAgdGhpcy5zbmFrZS5kcmF3KHRoaXMuY3R4KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGtleWJvYXJkSW5wdXQoKTogdm9pZCB7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAzNykge1xyXG4gICAgICAgICAgICB0aGlzLnNuYWtlLmNoYW5nZURpcmVjdGlvbihEaXJlY3Rpb24uTEVGVCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc25ha2UuY2hhbmdlRGlyZWN0aW9uKERpcmVjdGlvbi5VUCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc25ha2UuY2hhbmdlRGlyZWN0aW9uKERpcmVjdGlvbi5SSUdIVCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gNDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc25ha2UuY2hhbmdlRGlyZWN0aW9uKERpcmVjdGlvbi5ET1dOKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG52YXIgR2FtZSA6IFNuYWtlR2FtZSA9IG5ldyBTbmFrZUdhbWUoKTtcclxuXHJcblxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==