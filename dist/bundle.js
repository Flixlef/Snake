!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n,o=function(){function t(t,e){this.x=t,this.y=e,this.nextField=void 0}return t.prototype.detectCollision=function(t){return this.x===t.x&&this.y===t.y},t}();!function(t){t[t.UP=0]="UP",t[t.RIGHT=1]="RIGHT",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT"}(n||(n={}));var r,s=function(){function t(){}return t.GAME_WIDTH=20,t.GAME_HEIGHT=20,t.FIELD_SIZE=20,t}(),h=function(){function t(t){this.head=new o(2,7),this.tail=[],this.size=0,this.game=t}return t.prototype.draw=function(t){t.fillStyle="red",this.drawField(this.head,t,s.FIELD_SIZE);for(var e=0;e<this.tail.length;e++)this.drawField(this.tail[e],t,s.FIELD_SIZE)},t.prototype.changeDirection=function(t){t===n.LEFT&&this.direction===n.RIGHT||t===n.UP&&this.direction===n.DOWN||t===n.DOWN&&this.direction===n.UP||t===n.RIGHT&&this.direction===n.LEFT||(this.direction=t)},t.prototype.move=function(){if(void 0!==this.direction)return this.tail.push(this.head),this.head=this.getNext(),this.head.detectCollision(this.game.food)&&(this.size++,this.game.snakeFoundFood()),this.tail.length>this.size&&this.tail.splice(0,1),this.snakeSlidesIntoItself()},t.prototype.fieldsAreEmpty=function(t){var e=!1;this.head.detectCollision(t)&&(e=!0);for(var i=0;i<this.tail.length;i++)this.tail[i].detectCollision(t)&&(e=!0);return e},t.prototype.snakeSlidesIntoItself=function(){for(var t=0;t<this.tail.length;t++)if(this.head.detectCollision(this.tail[t]))return!0;return!1},t.prototype.getNext=function(){switch(this.direction){case n.UP:return this.head.y-1<1?new o(this.head.x,s.GAME_HEIGHT):new o(this.head.x,this.head.y-1);case n.RIGHT:return this.head.x+1>s.GAME_WIDTH?new o(1,this.head.y):new o(this.head.x+1,this.head.y);case n.DOWN:return this.head.y===s.GAME_HEIGHT?new o(this.head.x,1):new o(this.head.x,this.head.y+1);case n.LEFT:return this.head.x-1==0?new o(s.GAME_WIDTH,this.head.y):new o(this.head.x-1,this.head.y)}},t.prototype.drawField=function(t,e,i){e.fillRect((t.x-1)*i,(t.y-1)*i,i,i)},t}(),a=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.draw=function(t){t.fillStyle="green",t.fillRect((this.x-1)*s.FIELD_SIZE,(this.y-1)*s.FIELD_SIZE,s.FIELD_SIZE,s.FIELD_SIZE)},e}(o);i.d(e,"SnakeGame",function(){return d});var d=function(){function t(){var t=this,e=document.getElementById("snake");this.ctx=e.getContext("2d"),this.startNewGame(),setInterval(function(){t.nextStep()},100),this.keyboardInput()}return t.prototype.nextStep=function(){this.snake.move()?this.startNewGame():this.draw()},t.prototype.gameOver=function(){},t.prototype.snakeFoundFood=function(){this.placeNewFood(),this.increaseScore()},t.prototype.startNewGame=function(){this.snake=new h(this),this.food=new c(4,4),this.draw(),this.score=0},t.prototype.placeNewFood=function(){for(var t=Math.floor(Math.random()*(s.GAME_WIDTH-1+1))+1,e=Math.floor(Math.random()*(s.GAME_HEIGHT-1+1))+1,i=new c(t,e);this.snake.fieldsAreEmpty(i);)t=Math.floor(Math.random()*(s.GAME_WIDTH-1+1))+1,e=Math.floor(Math.random()*(s.GAME_HEIGHT-1+1))+1,i=new c(t,e);this.food=i},t.prototype.increaseScore=function(){this.score++},t.prototype.draw=function(){this.ctx.fillStyle="grey",this.ctx.fillRect(0,0,s.GAME_WIDTH*s.FIELD_SIZE,s.GAME_HEIGHT*s.FIELD_SIZE),this.food.draw(this.ctx),this.snake.draw(this.ctx)},t.prototype.keyboardInput=function(){var t=this;document.addEventListener("keydown",function(e){37===e.keyCode?t.snake.changeDirection(n.LEFT):38===e.keyCode?t.snake.changeDirection(n.UP):39===e.keyCode?t.snake.changeDirection(n.RIGHT):40===e.keyCode&&t.snake.changeDirection(n.DOWN)})},t}();new d}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2ZpZWxkLnRzIiwid2VicGFjazovLy8uL3NyYy9kaXJlY3Rpb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbnN0YW50LnRzIiwid2VicGFjazovLy8uL3NyYy9zbmFrZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZm9vZC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvc25ha2VfZ2FtZS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJ2YWx1ZSIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiRGlyZWN0aW9uIiwiRmllbGQiLCJ4IiwieSIsInRoaXMiLCJuZXh0RmllbGQiLCJ1bmRlZmluZWQiLCJkZXRlY3RDb2xsaXNpb24iLCJmaWVsZCIsIkNvbnN0YW50IiwiR0FNRV9XSURUSCIsIkdBTUVfSEVJR0hUIiwiRklFTERfU0laRSIsInNuYWtlX1NuYWtlIiwiU25ha2UiLCJnYW1lIiwiaGVhZCIsInRhaWwiLCJzaXplIiwiZHJhdyIsImN0eCIsImZpbGxTdHlsZSIsImRyYXdGaWVsZCIsImxlbmd0aCIsImNoYW5nZURpcmVjdGlvbiIsImRpcmVjdGlvbiIsIkxFRlQiLCJSSUdIVCIsIlVQIiwiRE9XTiIsIm1vdmUiLCJwdXNoIiwiZ2V0TmV4dCIsImZvb2QiLCJzbmFrZUZvdW5kRm9vZCIsInNwbGljZSIsInNuYWtlU2xpZGVzSW50b0l0c2VsZiIsImZpZWxkc0FyZUVtcHR5IiwiY29sbGlzaW9uIiwic25ha2VQYXJ0IiwiZmlsbFJlY3QiLCJmb29kX0Zvb2QiLCJfc3VwZXIiLCJGb29kIiwiX19leHRlbmRzIiwic25ha2VfZ2FtZV9TbmFrZUdhbWUiLCJTbmFrZUdhbWUiLCJfdGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0Iiwic3RhcnROZXdHYW1lIiwic2V0SW50ZXJ2YWwiLCJuZXh0U3RlcCIsImtleWJvYXJkSW5wdXQiLCJzbmFrZSIsImdhbWVPdmVyIiwicGxhY2VOZXdGb29kIiwiaW5jcmVhc2VTY29yZSIsInNjb3JlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5Q29kZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixFQUFBbUIsRUFBQSxTQUFBakIsR0FDQVksT0FBQUMsZUFBQWIsRUFBQSxjQUFpRGtCLE9BQUEsS0FJakRwQixFQUFBcUIsRUFBQSxTQUFBbEIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBbUIsV0FDQSxXQUEyQixPQUFBbkIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQVUsRUFBQUMsR0FBc0QsT0FBQVYsT0FBQVcsVUFBQUMsZUFBQW5CLEtBQUFnQixFQUFBQyxJQUd0RHhCLEVBQUEyQixFQUFBLEdBSUEzQixJQUFBNEIsRUFBQSx5Q0NuRUEsSUNBWUMsRURBWkMsRUFBQSxXQUtJLFNBQUFBLEVBQVlDLEVBQVlDLEdBQ3BCQyxLQUFLRixFQUFJQSxFQUNURSxLQUFLRCxFQUFJQSxFQUNUQyxLQUFLQyxlQUFZQyxFQU16QixPQUhXTCxFQUFBTCxVQUFBVyxnQkFBUCxTQUF1QkMsR0FDbkIsT0FBUUosS0FBS0YsSUFBTU0sRUFBTU4sR0FBS0UsS0FBS0QsSUFBTUssRUFBTUwsR0FFdkRGLEVBZEEsSUNBQSxTQUFZRCxHQUNSQSxJQUFBLFdBQ0FBLElBQUEsaUJBQ0FBLElBQUEsZUFDQUEsSUFBQSxlQUpKLENBQVlBLFdDQVosTUFBQVMsRUFBQSxvQkFBQUEsS0FJQSxPQUhvQkEsRUFBQUMsV0FBc0IsR0FDdEJELEVBQUFFLFlBQXVCLEdBQ3ZCRixFQUFBRyxXQUFzQixHQUMxQ0gsRUFKQSxHQ0tBSSxFQUFBLFdBT0ksU0FBQUMsRUFBWUMsR0FDUlgsS0FBS1ksS0FBTyxJQUFJZixFQUFNLEVBQUcsR0FDekJHLEtBQUthLFFBQ0xiLEtBQUtjLEtBQU8sRUFDWmQsS0FBS1csS0FBT0EsRUEwR3BCLE9BdkdXRCxFQUFBbEIsVUFBQXVCLEtBQVAsU0FBWUMsR0FDUkEsRUFBSUMsVUFBWSxNQUNoQmpCLEtBQUtrQixVQUFVbEIsS0FBS1ksS0FBTUksRUFBS1gsRUFBU0csWUFDeEMsSUFBSSxJQUFJckMsRUFBWSxFQUFHQSxFQUFJNkIsS0FBS2EsS0FBS00sT0FBUWhELElBQ3pDNkIsS0FBS2tCLFVBQVVsQixLQUFLYSxLQUFLMUMsR0FBSTZDLEVBQUtYLEVBQVNHLGFBSTVDRSxFQUFBbEIsVUFBQTRCLGdCQUFQLFNBQXVCQyxHQUNoQkEsSUFBY3pCLEVBQVUwQixNQUFRdEIsS0FBS3FCLFlBQWN6QixFQUFVMkIsT0FFckRGLElBQWN6QixFQUFVNEIsSUFBTXhCLEtBQUtxQixZQUFjekIsRUFBVTZCLE1BRTNESixJQUFjekIsRUFBVTZCLE1BQVF6QixLQUFLcUIsWUFBY3pCLEVBQVU0QixJQUU3REgsSUFBY3pCLEVBQVUyQixPQUFTdkIsS0FBS3FCLFlBQWN6QixFQUFVMEIsT0FHekV0QixLQUFLcUIsVUFBWUEsSUFHZFgsRUFBQWxCLFVBQUFrQyxLQUFQLFdBQ0ksUUFBc0J4QixJQUFuQkYsS0FBS3FCLFVBbUJSLE9BZkFyQixLQUFLYSxLQUFLYyxLQUFLM0IsS0FBS1ksTUFHcEJaLEtBQUtZLEtBQU9aLEtBQUs0QixVQUVkNUIsS0FBS1ksS0FBS1QsZ0JBQWdCSCxLQUFLVyxLQUFLa0IsUUFDbkM3QixLQUFLYyxPQUNMZCxLQUFLVyxLQUFLbUIsa0JBSVY5QixLQUFLYSxLQUFLTSxPQUFTbkIsS0FBS2MsTUFDeEJkLEtBQUthLEtBQUtrQixPQUFPLEVBQUcsR0FHakIvQixLQUFLZ0MseUJBR1R0QixFQUFBbEIsVUFBQXlDLGVBQVAsU0FBc0I3QixHQUNsQixJQUFJOEIsR0FBc0IsRUFFdkJsQyxLQUFLWSxLQUFLVCxnQkFBZ0JDLEtBQ3pCOEIsR0FBWSxHQUdoQixJQUFJLElBQUkvRCxFQUFZLEVBQUdBLEVBQUk2QixLQUFLYSxLQUFLTSxPQUFRaEQsSUFDdEM2QixLQUFLYSxLQUFLMUMsR0FBR2dDLGdCQUFnQkMsS0FDNUI4QixHQUFZLEdBSXBCLE9BQU9BLEdBSUh4QixFQUFBbEIsVUFBQXdDLHNCQUFSLFdBQ0ksSUFBSSxJQUFJN0QsRUFBWSxFQUFHQSxFQUFJNkIsS0FBS2EsS0FBS00sT0FBUWhELElBQ3pDLEdBQUc2QixLQUFLWSxLQUFLVCxnQkFBZ0JILEtBQUthLEtBQUsxQyxJQUNuQyxPQUFPLEVBSWYsT0FBTyxHQUdIdUMsRUFBQWxCLFVBQUFvQyxRQUFSLFdBQ0ksT0FBUTVCLEtBQUtxQixXQUNULEtBQUt6QixFQUFVNEIsR0FDWCxPQUFHeEIsS0FBS1ksS0FBS2IsRUFBSSxFQUFJLEVBQ1YsSUFBSUYsRUFBTUcsS0FBS1ksS0FBS2QsRUFBR08sRUFBU0UsYUFFaEMsSUFBSVYsRUFBTUcsS0FBS1ksS0FBS2QsRUFBR0UsS0FBS1ksS0FBS2IsRUFBSSxHQUVwRCxLQUFLSCxFQUFVMkIsTUFDWCxPQUFHdkIsS0FBS1ksS0FBS2QsRUFBSSxFQUFJTyxFQUFTQyxXQUNuQixJQUFJVCxFQUFNLEVBQUdHLEtBQUtZLEtBQUtiLEdBRXZCLElBQUlGLEVBQU1HLEtBQUtZLEtBQUtkLEVBQUksRUFBR0UsS0FBS1ksS0FBS2IsR0FFcEQsS0FBS0gsRUFBVTZCLEtBQ1gsT0FBR3pCLEtBQUtZLEtBQUtiLElBQU1NLEVBQVNFLFlBQ2pCLElBQUlWLEVBQU1HLEtBQUtZLEtBQUtkLEVBQUcsR0FFdkIsSUFBSUQsRUFBTUcsS0FBS1ksS0FBS2QsRUFBR0UsS0FBS1ksS0FBS2IsRUFBSSxHQUVwRCxLQUFLSCxFQUFVMEIsS0FDWCxPQUFHdEIsS0FBS1ksS0FBS2QsRUFBSSxHQUFNLEVBQ1osSUFBSUQsRUFBTVEsRUFBU0MsV0FBWU4sS0FBS1ksS0FBS2IsR0FFekMsSUFBSUYsRUFBTUcsS0FBS1ksS0FBS2QsRUFBRSxFQUFHRSxLQUFLWSxLQUFLYixLQUtsRFcsRUFBQWxCLFVBQUEwQixVQUFSLFNBQWtCaUIsRUFBa0JuQixFQUErQkYsR0FDL0RFLEVBQUlvQixVQUFVRCxFQUFVckMsRUFBSSxHQUFLZ0IsR0FBT3FCLEVBQVVwQyxFQUFJLEdBQUtlLEVBQU1BLEVBQU1BLElBRS9FSixFQXJIQSx5UkNGQTJCLEVBQUEsU0FBQUMsR0FBQSxTQUFBQyxtREFLQSxPQUwwQkMsRUFBQUQsRUFBQUQsR0FDZkMsRUFBQS9DLFVBQUF1QixLQUFQLFNBQVlDLEdBQ1JBLEVBQUlDLFVBQVksUUFDaEJELEVBQUlvQixVQUFVcEMsS0FBS0YsRUFBSSxHQUFLTyxFQUFTRyxZQUFhUixLQUFLRCxFQUFJLEdBQUtNLEVBQVNHLFdBQVdILEVBQVNHLFdBQVlILEVBQVNHLGFBRTFIK0IsRUFMQSxDQUEwQjFDLDJDQ0UxQixJQUFBNEMsRUFBQSxXQU1JLFNBQUFDLElBQUEsSUFBQUMsRUFBQTNDLEtBQ1E0QyxFQUFpREMsU0FBU0MsZUFBZSxTQUM3RTlDLEtBQUtnQixJQUFNNEIsRUFBT0csV0FBVyxNQUU3Qi9DLEtBQUtnRCxlQUVMQyxZQUFZLFdBQ1JOLEVBQUtPLFlBQ04sS0FDSGxELEtBQUttRCxnQkFpRWIsT0E5RFdULEVBQUFsRCxVQUFBMEQsU0FBUCxXQUNPbEQsS0FBS29ELE1BQU0xQixPQUNWMUIsS0FBS2dELGVBR1RoRCxLQUFLZSxRQUdGMkIsRUFBQWxELFVBQUE2RCxTQUFQLGFBSU9YLEVBQUFsRCxVQUFBc0MsZUFBUCxXQUNJOUIsS0FBS3NELGVBQ0x0RCxLQUFLdUQsaUJBR0ZiLEVBQUFsRCxVQUFBd0QsYUFBUCxXQUNJaEQsS0FBS29ELE1BQVEsSUFBSTNDLEVBQU1ULE1BQ3ZCQSxLQUFLNkIsS0FBTyxJQUFJUSxFQUFLLEVBQUcsR0FDeEJyQyxLQUFLZSxPQUNMZixLQUFLd0QsTUFBUSxHQUdUZCxFQUFBbEQsVUFBQThELGFBQVIsV0FLSSxJQUpBLElBQUl4RCxFQUFhMkQsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWXRELEVBQVNDLFdBQWEsRUFBSSxJQUFNLEVBQ3pFUCxFQUFhMEQsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWXRELEVBQVNFLFlBQWMsRUFBSSxJQUFNLEVBQzFFc0IsRUFBYyxJQUFJUSxFQUFLdkMsRUFBR0MsR0FFeEJDLEtBQUtvRCxNQUFNbkIsZUFBZUosSUFDNUIvQixFQUFJMkQsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWXRELEVBQVNDLFdBQWEsRUFBSSxJQUFNLEVBQ2hFUCxFQUFJMEQsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWXRELEVBQVNFLFlBQWMsRUFBSSxJQUFNLEVBQ2pFc0IsRUFBTyxJQUFJUSxFQUFLdkMsRUFBR0MsR0FHdkJDLEtBQUs2QixLQUFPQSxHQUdSYSxFQUFBbEQsVUFBQStELGNBQVIsV0FDSXZELEtBQUt3RCxTQUdEZCxFQUFBbEQsVUFBQXVCLEtBQVIsV0FDSWYsS0FBS2dCLElBQUlDLFVBQVksT0FDckJqQixLQUFLZ0IsSUFBSW9CLFNBQVMsRUFBRyxFQUFHL0IsRUFBU0MsV0FBYUQsRUFBU0csV0FBWUgsRUFBU0UsWUFBY0YsRUFBU0csWUFDbkdSLEtBQUs2QixLQUFLZCxLQUFLZixLQUFLZ0IsS0FDcEJoQixLQUFLb0QsTUFBTXJDLEtBQUtmLEtBQUtnQixNQUdqQjBCLEVBQUFsRCxVQUFBMkQsY0FBUixlQUFBUixFQUFBM0MsS0FDSTZDLFNBQVNlLGlCQUFpQixVQUFXLFNBQUNDLEdBQ1osS0FBbEJBLEVBQU1DLFFBQ1ZuQixFQUFLUyxNQUFNaEMsZ0JBQWdCeEIsRUFBVTBCLE1BQ1IsS0FBbEJ1QyxFQUFNQyxRQUNibkIsRUFBS1MsTUFBTWhDLGdCQUFnQnhCLEVBQVU0QixJQUNaLEtBQWxCcUMsRUFBTUMsUUFDYm5CLEVBQUtTLE1BQU1oQyxnQkFBZ0J4QixFQUFVMkIsT0FDWixLQUFsQnNDLEVBQU1DLFNBQ2JuQixFQUFLUyxNQUFNaEMsZ0JBQWdCeEIsRUFBVTZCLFNBSXJEaUIsRUFoRkEsR0FrRnVCLElBQUlEIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgY2xhc3MgRmllbGQge1xyXG4gICAgcHVibGljIG5leHRGaWVsZCA6IEZpZWxkO1xyXG4gICAgcHVibGljIHggOiBudW1iZXI7XHJcbiAgICBwdWJsaWMgeSA6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih4IDogbnVtYmVyLCB5IDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICB0aGlzLnkgPSB5O1xyXG4gICAgICAgIHRoaXMubmV4dEZpZWxkID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkZXRlY3RDb2xsaXNpb24oZmllbGQ6IEZpZWxkKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLnggPT09IGZpZWxkLnggJiYgdGhpcy55ID09PSBmaWVsZC55KTtcclxuICAgIH1cclxufSIsImV4cG9ydCBlbnVtIERpcmVjdGlvbiB7XHJcbiAgICBVUCxcclxuICAgIFJJR0hULFxyXG4gICAgRE9XTixcclxuICAgIExFRlRcclxufSIsImV4cG9ydCBjbGFzcyBDb25zdGFudCB7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgR0FNRV9XSURUSCA6IG51bWJlciA9IDIwO1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IEdBTUVfSEVJR0hUIDogbnVtYmVyID0gMjA7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgRklFTERfU0laRSA6IG51bWJlciA9IDIwO1xyXG59IiwiaW1wb3J0IHsgRmllbGQgfSBmcm9tIFwiLi9maWVsZFwiO1xyXG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tIFwiLi9kaXJlY3Rpb25cIjtcclxuaW1wb3J0IHsgU25ha2VHYW1lIH0gZnJvbSBcIi4vc25ha2VfZ2FtZVwiO1xyXG5pbXBvcnQgeyBDb25zdGFudCB9IGZyb20gXCIuL2NvbnN0YW50XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU25ha2Uge1xyXG4gICAgcHJpdmF0ZSBnYW1lIDogU25ha2VHYW1lO1xyXG4gICAgcHJpdmF0ZSBoZWFkIDogRmllbGQ7XHJcbiAgICBwcml2YXRlIHRhaWwgOiBGaWVsZFtdO1xyXG4gICAgcHJpdmF0ZSBzaXplIDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBkaXJlY3Rpb246IERpcmVjdGlvbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihnYW1lOiBTbmFrZUdhbWUpIHtcclxuICAgICAgICB0aGlzLmhlYWQgPSBuZXcgRmllbGQoMiwgNyk7XHJcbiAgICAgICAgdGhpcy50YWlsID0gW107XHJcbiAgICAgICAgdGhpcy5zaXplID0gMDtcclxuICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KGN0eCA6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6IHZvaWQge1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xyXG4gICAgICAgIHRoaXMuZHJhd0ZpZWxkKHRoaXMuaGVhZCwgY3R4LCBDb25zdGFudC5GSUVMRF9TSVpFKTtcclxuICAgICAgICBmb3IodmFyIGk6IG51bWJlciA9IDA7IGkgPCB0aGlzLnRhaWwubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5kcmF3RmllbGQodGhpcy50YWlsW2ldLCBjdHgsIENvbnN0YW50LkZJRUxEX1NJWkUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2hhbmdlRGlyZWN0aW9uKGRpcmVjdGlvbjogRGlyZWN0aW9uKTogdm9pZCB7XHJcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uTEVGVCAmJiB0aGlzLmRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLlJJR0hUKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLlVQICYmIHRoaXMuZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uRE9XTikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5ET1dOICYmIHRoaXMuZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uVVApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uUklHSFQgJiYgdGhpcy5kaXJlY3Rpb24gPT09IERpcmVjdGlvbi5MRUZUKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG1vdmUoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYodGhpcy5kaXJlY3Rpb24gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGFkZCBjdXJyZW50IGhlYWQgdG8gdGFpbFxyXG4gICAgICAgIHRoaXMudGFpbC5wdXNoKHRoaXMuaGVhZCk7XHJcblxyXG4gICAgICAgIC8vIGdldCBuZXh0IHBvc2l0aW9uXHJcbiAgICAgICAgdGhpcy5oZWFkID0gdGhpcy5nZXROZXh0KCk7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuaGVhZC5kZXRlY3RDb2xsaXNpb24odGhpcy5nYW1lLmZvb2QpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSsrO1xyXG4gICAgICAgICAgICB0aGlzLmdhbWUuc25ha2VGb3VuZEZvb2QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGZpeCB0aGUgd29ybSBzaXplXHJcbiAgICAgICAgaWYgKHRoaXMudGFpbC5sZW5ndGggPiB0aGlzLnNpemUpIHtcclxuICAgICAgICAgICAgdGhpcy50YWlsLnNwbGljZSgwLCAxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnNuYWtlU2xpZGVzSW50b0l0c2VsZigpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmaWVsZHNBcmVFbXB0eShmaWVsZDogRmllbGQpOiBib29sZWFuIHtcclxuICAgICAgICB2YXIgY29sbGlzaW9uIDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZih0aGlzLmhlYWQuZGV0ZWN0Q29sbGlzaW9uKGZpZWxkKSkge1xyXG4gICAgICAgICAgICBjb2xsaXNpb24gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yKHZhciBpOiBudW1iZXIgPSAwOyBpIDwgdGhpcy50YWlsLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMudGFpbFtpXS5kZXRlY3RDb2xsaXNpb24oZmllbGQpKSB7XHJcbiAgICAgICAgICAgICAgICBjb2xsaXNpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY29sbGlzaW9uO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHNuYWtlU2xpZGVzSW50b0l0c2VsZigpOiBib29sZWFuIHtcclxuICAgICAgICBmb3IodmFyIGk6IG51bWJlciA9IDA7IGkgPCB0aGlzLnRhaWwubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYodGhpcy5oZWFkLmRldGVjdENvbGxpc2lvbih0aGlzLnRhaWxbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TmV4dCgpOiBGaWVsZCB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5VUDpcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaGVhZC55IC0gMSA8IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMuaGVhZC54LCBDb25zdGFudC5HQU1FX0hFSUdIVCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQodGhpcy5oZWFkLngsIHRoaXMuaGVhZC55IC0gMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLlJJR0hUOlxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5oZWFkLnggKyAxID4gQ29uc3RhbnQuR0FNRV9XSURUSCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQoMSwgdGhpcy5oZWFkLnkpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMuaGVhZC54ICsgMSwgdGhpcy5oZWFkLnkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5ET1dOOlxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5oZWFkLnkgPT09IENvbnN0YW50LkdBTUVfSEVJR0hUKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZCh0aGlzLmhlYWQueCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQodGhpcy5oZWFkLngsIHRoaXMuaGVhZC55ICsgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLkxFRlQ6XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmhlYWQueCAtIDEgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKENvbnN0YW50LkdBTUVfV0lEVEgsIHRoaXMuaGVhZC55KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZCh0aGlzLmhlYWQueC0xLCB0aGlzLmhlYWQueSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZHJhd0ZpZWxkKHNuYWtlUGFydDogRmllbGQsIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBzaXplOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBjdHguZmlsbFJlY3QoKHNuYWtlUGFydC54IC0gMSkgKiBzaXplLCAoc25ha2VQYXJ0LnkgLSAxKSAqIHNpemUsIHNpemUsIHNpemUpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgRmllbGQgfSBmcm9tIFwiLi9maWVsZFwiO1xyXG5pbXBvcnQgeyBDb25zdGFudCB9IGZyb20gXCIuL2NvbnN0YW50XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgRm9vZCBleHRlbmRzIEZpZWxkIHtcclxuICAgIHB1YmxpYyBkcmF3KGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTp2b2lkIHtcclxuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJncmVlblwiO1xyXG4gICAgICAgIGN0eC5maWxsUmVjdCgodGhpcy54IC0gMSkgKiBDb25zdGFudC5GSUVMRF9TSVpFLCAodGhpcy55IC0gMSkgKiBDb25zdGFudC5GSUVMRF9TSVpFLENvbnN0YW50LkZJRUxEX1NJWkUsIENvbnN0YW50LkZJRUxEX1NJWkUpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgU25ha2UgfSBmcm9tIFwiLi9zbmFrZVwiO1xyXG5pbXBvcnQgeyBGb29kIH0gZnJvbSBcIi4vZm9vZFwiO1xyXG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tIFwiLi9kaXJlY3Rpb25cIjtcclxuaW1wb3J0IHsgQ29uc3RhbnQgfSBmcm9tIFwiLi9jb25zdGFudFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNuYWtlR2FtZSB7XHJcbiAgICBwdWJsaWMgZm9vZCA6IEZvb2Q7XHJcbiAgICBwcml2YXRlIHNuYWtlIDogU25ha2U7XHJcbiAgICBwcml2YXRlIGN0eCA6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuICAgIHByaXZhdGUgc2NvcmUgOiBudW1iZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdmFyIGNhbnZhcyA6IEhUTUxDYW52YXNFbGVtZW50ID0gPEhUTUxDYW52YXNFbGVtZW50PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNuYWtlXCIpO1xyXG4gICAgICAgIHRoaXMuY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGFydE5ld0dhbWUoKTtcclxuXHJcbiAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm5leHRTdGVwKCk7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICB0aGlzLmtleWJvYXJkSW5wdXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbmV4dFN0ZXAoKTogdm9pZCB7XHJcbiAgICAgICAgaWYodGhpcy5zbmFrZS5tb3ZlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zdGFydE5ld0dhbWUoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2FtZU92ZXIoKTogdm9pZCB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzbmFrZUZvdW5kRm9vZCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnBsYWNlTmV3Rm9vZCgpO1xyXG4gICAgICAgIHRoaXMuaW5jcmVhc2VTY29yZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGFydE5ld0dhbWUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zbmFrZSA9IG5ldyBTbmFrZSh0aGlzKTtcclxuICAgICAgICB0aGlzLmZvb2QgPSBuZXcgRm9vZCg0LCA0KTtcclxuICAgICAgICB0aGlzLmRyYXcoKTtcclxuICAgICAgICB0aGlzLnNjb3JlID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHBsYWNlTmV3Rm9vZCgpOiB2b2lkIHtcclxuICAgICAgICB2YXIgeCA6IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChDb25zdGFudC5HQU1FX1dJRFRIIC0gMSArIDEpKSArIDE7XHJcbiAgICAgICAgdmFyIHkgOiBudW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoQ29uc3RhbnQuR0FNRV9IRUlHSFQgLSAxICsgMSkpICsgMTtcclxuICAgICAgICB2YXIgZm9vZCA6IEZvb2QgPSBuZXcgRm9vZCh4LCB5KTtcclxuXHJcbiAgICAgICAgd2hpbGUodGhpcy5zbmFrZS5maWVsZHNBcmVFbXB0eShmb29kKSkge1xyXG4gICAgICAgICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKENvbnN0YW50LkdBTUVfV0lEVEggLSAxICsgMSkpICsgMTtcclxuICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChDb25zdGFudC5HQU1FX0hFSUdIVCAtIDEgKyAxKSkgKyAxO1xyXG4gICAgICAgICAgICBmb29kID0gbmV3IEZvb2QoeCwgeSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZvb2QgPSBmb29kO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5jcmVhc2VTY29yZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNjb3JlKys7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IFwiZ3JleVwiO1xyXG4gICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIENvbnN0YW50LkdBTUVfV0lEVEggKiBDb25zdGFudC5GSUVMRF9TSVpFLCBDb25zdGFudC5HQU1FX0hFSUdIVCAqIENvbnN0YW50LkZJRUxEX1NJWkUpO1xyXG4gICAgICAgIHRoaXMuZm9vZC5kcmF3KHRoaXMuY3R4KTtcclxuICAgICAgICB0aGlzLnNuYWtlLmRyYXcodGhpcy5jdHgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUga2V5Ym9hcmRJbnB1dCgpOiB2b2lkIHtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDM3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc25ha2UuY2hhbmdlRGlyZWN0aW9uKERpcmVjdGlvbi5MRUZUKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSAzOCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbmFrZS5jaGFuZ2VEaXJlY3Rpb24oRGlyZWN0aW9uLlVQKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSAzOSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbmFrZS5jaGFuZ2VEaXJlY3Rpb24oRGlyZWN0aW9uLlJJR0hUKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSA0MCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbmFrZS5jaGFuZ2VEaXJlY3Rpb24oRGlyZWN0aW9uLkRPV04pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbnZhciBHYW1lIDogU25ha2VHYW1lID0gbmV3IFNuYWtlR2FtZSgpO1xyXG5cclxuXHJcblxyXG4iXSwic291cmNlUm9vdCI6IiJ9