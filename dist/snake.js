!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n,o=function(){function t(t,e){this.x=t,this.y=e,this.nextField=void 0}return t.prototype.detectCollision=function(t){return this.x===t.x&&this.y===t.y},t}();!function(t){t[t.UP=0]="UP",t[t.RIGHT=1]="RIGHT",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT"}(n||(n={}));var r,s=function(){function t(){}return t.GAME_WIDTH=20,t.GAME_HEIGHT=20,t.FIELD_SIZE=20,t.GAME_SPEED=1e3/15,t}(),h=function(){function t(t){this.head=new o(2,7),this.tail=[],this.size=0,this.game=t}return t.prototype.draw=function(t){t.fillStyle="red",this.drawField(this.head,t,s.FIELD_SIZE);for(var e=0;e<this.tail.length;e++)this.drawField(this.tail[e],t,s.FIELD_SIZE)},t.prototype.changeDirection=function(t){t===n.LEFT&&this.direction===n.RIGHT||t===n.UP&&this.direction===n.DOWN||t===n.DOWN&&this.direction===n.UP||t===n.RIGHT&&this.direction===n.LEFT||(this.direction=t)},t.prototype.move=function(){void 0!==this.direction&&(this.tail.push(this.head),this.head=this.getNext(),this.head.detectCollision(this.game.food)&&(this.size++,this.game.snakeFoundFood()),this.tail.length>this.size&&this.tail.splice(0,1))},t.prototype.snakeIsNotHere=function(t){var e=!1;this.head.detectCollision(t)&&(e=!0);for(var i=0;i<this.tail.length;i++)this.tail[i].detectCollision(t)&&(e=!0);return e},t.prototype.snakeSlidesIntoItself=function(){for(var t=0;t<this.tail.length;t++)if(this.head.detectCollision(this.tail[t]))return!0;return!1},t.prototype.getNext=function(){switch(this.direction){case n.UP:return this.head.y-1<1?new o(this.head.x,s.GAME_HEIGHT):new o(this.head.x,this.head.y-1);case n.RIGHT:return this.head.x+1>s.GAME_WIDTH?new o(1,this.head.y):new o(this.head.x+1,this.head.y);case n.DOWN:return this.head.y===s.GAME_HEIGHT?new o(this.head.x,1):new o(this.head.x,this.head.y+1);case n.LEFT:return this.head.x-1==0?new o(s.GAME_WIDTH,this.head.y):new o(this.head.x-1,this.head.y)}},t.prototype.drawField=function(t,e,i){e.fillRect((t.x-1)*i,(t.y-1)*i,i,i)},t}(),a=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.draw=function(t){t.fillStyle="green",t.fillRect((this.x-1)*s.FIELD_SIZE,(this.y-1)*s.FIELD_SIZE,s.FIELD_SIZE,s.FIELD_SIZE)},e}(o);i.d(e,"SnakeGame",function(){return d});var d=function(){function t(){var t=this,e=document.getElementById("snake");this.ctx=e.getContext("2d"),this.startNewGame(),setInterval(function(){t.nextStep()},s.GAME_SPEED),this.keyboardInput()}return t.prototype.nextStep=function(){this.snake.move(),this.snake.snakeSlidesIntoItself()?this.startNewGame():this.draw()},t.prototype.snakeFoundFood=function(){this.placeNewFood(),this.increaseScore()},t.prototype.startNewGame=function(){this.snake=new h(this),this.food=new c(4,4),this.draw(),this.score=0},t.prototype.placeNewFood=function(){for(var t=Math.floor(Math.random()*(s.GAME_WIDTH-1+1))+1,e=Math.floor(Math.random()*(s.GAME_HEIGHT-1+1))+1,i=new c(t,e);this.snake.snakeIsNotHere(i);)t=Math.floor(Math.random()*(s.GAME_WIDTH-1+1))+1,e=Math.floor(Math.random()*(s.GAME_HEIGHT-1+1))+1,i=new c(t,e);this.food=i},t.prototype.increaseScore=function(){this.score++},t.prototype.draw=function(){this.ctx.fillStyle="grey",this.ctx.fillRect(0,0,s.GAME_WIDTH*s.FIELD_SIZE,s.GAME_HEIGHT*s.FIELD_SIZE),this.food.draw(this.ctx),this.snake.draw(this.ctx)},t.prototype.keyboardInput=function(){var t=this;document.addEventListener("keydown",function(e){37===e.keyCode?t.snake.changeDirection(n.LEFT):38===e.keyCode?t.snake.changeDirection(n.UP):39===e.keyCode?t.snake.changeDirection(n.RIGHT):40===e.keyCode&&t.snake.changeDirection(n.DOWN)})},t}();new d}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2ZpZWxkLnRzIiwid2VicGFjazovLy8uL3NyYy9kaXJlY3Rpb24udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbnN0YW50LnRzIiwid2VicGFjazovLy8uL3NyYy9zbmFrZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZm9vZC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvc25ha2VfZ2FtZS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJ2YWx1ZSIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiRGlyZWN0aW9uIiwiRmllbGQiLCJ4IiwieSIsInRoaXMiLCJuZXh0RmllbGQiLCJ1bmRlZmluZWQiLCJkZXRlY3RDb2xsaXNpb24iLCJmaWVsZCIsIkNvbnN0YW50IiwiR0FNRV9XSURUSCIsIkdBTUVfSEVJR0hUIiwiRklFTERfU0laRSIsIkdBTUVfU1BFRUQiLCJzbmFrZV9TbmFrZSIsIlNuYWtlIiwiZ2FtZSIsImhlYWQiLCJ0YWlsIiwic2l6ZSIsImRyYXciLCJjdHgiLCJmaWxsU3R5bGUiLCJkcmF3RmllbGQiLCJsZW5ndGgiLCJjaGFuZ2VEaXJlY3Rpb24iLCJkaXJlY3Rpb24iLCJMRUZUIiwiUklHSFQiLCJVUCIsIkRPV04iLCJtb3ZlIiwicHVzaCIsImdldE5leHQiLCJmb29kIiwic25ha2VGb3VuZEZvb2QiLCJzcGxpY2UiLCJzbmFrZUlzTm90SGVyZSIsImNvbGxpc2lvbiIsInNuYWtlU2xpZGVzSW50b0l0c2VsZiIsInNuYWtlUGFydCIsImZpbGxSZWN0IiwiZm9vZF9Gb29kIiwiX3N1cGVyIiwiRm9vZCIsIl9fZXh0ZW5kcyIsInNuYWtlX2dhbWVfU25ha2VHYW1lIiwiU25ha2VHYW1lIiwiX3RoaXMiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsInN0YXJ0TmV3R2FtZSIsInNldEludGVydmFsIiwibmV4dFN0ZXAiLCJrZXlib2FyZElucHV0Iiwic25ha2UiLCJwbGFjZU5ld0Zvb2QiLCJpbmNyZWFzZVNjb3JlIiwic2NvcmUiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJrZXlDb2RlIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFaLEVBQUFtQixFQUFBLFNBQUFqQixHQUNBWSxPQUFBQyxlQUFBYixFQUFBLGNBQWlEa0IsT0FBQSxLQUlqRHBCLEVBQUFxQixFQUFBLFNBQUFsQixHQUNBLElBQUFTLEVBQUFULEtBQUFtQixXQUNBLFdBQTJCLE9BQUFuQixFQUFBLFNBQzNCLFdBQWlDLE9BQUFBLEdBRWpDLE9BREFILEVBQUFVLEVBQUFFLEVBQUEs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SUFBSUMsVUFBWSxPQUNyQmxCLEtBQUtpQixJQUFJb0IsU0FBUyxFQUFHLEVBQUdoQyxFQUFTQyxXQUFhRCxFQUFTRyxXQUFZSCxFQUFTRSxZQUFjRixFQUFTRyxZQUNuR1IsS0FBSzhCLEtBQUtkLEtBQUtoQixLQUFLaUIsS0FDcEJqQixLQUFLcUQsTUFBTXJDLEtBQUtoQixLQUFLaUIsTUFHakIwQixFQUFBbkQsVUFBQTRELGNBQVIsZUFBQVIsRUFBQTVDLEtBQ0k4QyxTQUFTYyxpQkFBaUIsVUFBVyxTQUFDQyxHQUNaLEtBQWxCQSxFQUFNQyxRQUNWbEIsRUFBS1MsTUFBTWhDLGdCQUFnQnpCLEVBQVUyQixNQUNSLEtBQWxCc0MsRUFBTUMsUUFDYmxCLEVBQUtTLE1BQU1oQyxnQkFBZ0J6QixFQUFVNkIsSUFDWixLQUFsQm9DLEVBQU1DLFFBQ2JsQixFQUFLUyxNQUFNaEMsZ0JBQWdCekIsRUFBVTRCLE9BQ1osS0FBbEJxQyxFQUFNQyxTQUNibEIsRUFBS1MsTUFBTWhDLGdCQUFnQnpCLEVBQVU4QixTQUlyRGlCLEVBN0VBLEdBZ0Z1QixJQUFJRCIsImZpbGUiOiJzbmFrZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgY2xhc3MgRmllbGQge1xyXG4gICAgcHVibGljIG5leHRGaWVsZCA6IEZpZWxkO1xyXG4gICAgcHVibGljIHggOiBudW1iZXI7XHJcbiAgICBwdWJsaWMgeSA6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih4IDogbnVtYmVyLCB5IDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICB0aGlzLnkgPSB5O1xyXG4gICAgICAgIHRoaXMubmV4dEZpZWxkID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkZXRlY3RDb2xsaXNpb24oZmllbGQ6IEZpZWxkKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueCA9PT0gZmllbGQueCAmJiB0aGlzLnkgPT09IGZpZWxkLnk7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZW51bSBEaXJlY3Rpb24ge1xyXG4gICAgVVAsXHJcbiAgICBSSUdIVCxcclxuICAgIERPV04sXHJcbiAgICBMRUZUXHJcbn0iLCJleHBvcnQgY2xhc3MgQ29uc3RhbnQge1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IEdBTUVfV0lEVEggOiBudW1iZXIgPSAyMDtcclxuICAgIHN0YXRpYyByZWFkb25seSBHQU1FX0hFSUdIVCA6IG51bWJlciA9IDIwO1xyXG4gICAgLy8gc2l6ZSBvZiBvbmUgc3F1YXJlXHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgRklFTERfU0laRSA6IG51bWJlciA9IDIwO1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IEdBTUVfU1BFRUQgOiBudW1iZXIgPSAxMDAwIC8gMTU7XHJcbn0iLCJpbXBvcnQgeyBGaWVsZCB9IGZyb20gXCIuL2ZpZWxkXCI7XHJcbmltcG9ydCB7IERpcmVjdGlvbiB9IGZyb20gXCIuL2RpcmVjdGlvblwiO1xyXG5pbXBvcnQgeyBTbmFrZUdhbWUgfSBmcm9tIFwiLi9zbmFrZV9nYW1lXCI7XHJcbmltcG9ydCB7IENvbnN0YW50IH0gZnJvbSBcIi4vY29uc3RhbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTbmFrZSB7XHJcbiAgICBwcml2YXRlIGdhbWUgOiBTbmFrZUdhbWU7XHJcbiAgICBwcml2YXRlIGhlYWQgOiBGaWVsZDtcclxuICAgIHByaXZhdGUgdGFpbCA6IEZpZWxkW107XHJcbiAgICBwcml2YXRlIHNpemUgOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGRpcmVjdGlvbjogRGlyZWN0aW9uO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGdhbWU6IFNuYWtlR2FtZSkge1xyXG4gICAgICAgIC8vIHRvdGFsbHkgcmFuZG9tIHNldHMgdGhlIHNuYWtlIEAgWzIsN11cclxuICAgICAgICB0aGlzLmhlYWQgPSBuZXcgRmllbGQoMiwgNyk7XHJcbiAgICAgICAgdGhpcy50YWlsID0gW107XHJcbiAgICAgICAgdGhpcy5zaXplID0gMDtcclxuICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KGN0eCA6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6IHZvaWQge1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xyXG4gICAgICAgIHRoaXMuZHJhd0ZpZWxkKHRoaXMuaGVhZCwgY3R4LCBDb25zdGFudC5GSUVMRF9TSVpFKTtcclxuICAgICAgICBmb3IodmFyIGk6IG51bWJlciA9IDA7IGkgPCB0aGlzLnRhaWwubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5kcmF3RmllbGQodGhpcy50YWlsW2ldLCBjdHgsIENvbnN0YW50LkZJRUxEX1NJWkUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2hhbmdlRGlyZWN0aW9uKGRpcmVjdGlvbjogRGlyZWN0aW9uKTogdm9pZCB7XHJcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uTEVGVCAmJiB0aGlzLmRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLlJJR0hUKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLlVQICYmIHRoaXMuZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uRE9XTikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5ET1dOICYmIHRoaXMuZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uVVApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uUklHSFQgJiYgdGhpcy5kaXJlY3Rpb24gPT09IERpcmVjdGlvbi5MRUZUKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG1vdmUoKTogdm9pZCB7XHJcbiAgICAgICAgaWYodGhpcy5kaXJlY3Rpb24gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGFkZCBjdXJyZW50IGhlYWQgdG8gdGFpbFxyXG4gICAgICAgIHRoaXMudGFpbC5wdXNoKHRoaXMuaGVhZCk7XHJcblxyXG4gICAgICAgIC8vIGdldCBuZXh0IHBvc2l0aW9uXHJcbiAgICAgICAgdGhpcy5oZWFkID0gdGhpcy5nZXROZXh0KCk7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuaGVhZC5kZXRlY3RDb2xsaXNpb24odGhpcy5nYW1lLmZvb2QpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSsrO1xyXG4gICAgICAgICAgICB0aGlzLmdhbWUuc25ha2VGb3VuZEZvb2QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGZpeCB0aGUgd29ybSBzaXplXHJcbiAgICAgICAgaWYgKHRoaXMudGFpbC5sZW5ndGggPiB0aGlzLnNpemUpIHtcclxuICAgICAgICAgICAgdGhpcy50YWlsLnNwbGljZSgwLCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNuYWtlSXNOb3RIZXJlKGZpZWxkOiBGaWVsZCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHZhciBjb2xsaXNpb24gOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuaGVhZC5kZXRlY3RDb2xsaXNpb24oZmllbGQpKSB7XHJcbiAgICAgICAgICAgIGNvbGxpc2lvbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IodmFyIGk6IG51bWJlciA9IDA7IGkgPCB0aGlzLnRhaWwubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYodGhpcy50YWlsW2ldLmRldGVjdENvbGxpc2lvbihmaWVsZCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbGxpc2lvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb2xsaXNpb247XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBzbmFrZVNsaWRlc0ludG9JdHNlbGYoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgZm9yKHZhciBpOiBudW1iZXIgPSAwOyBpIDwgdGhpcy50YWlsLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaGVhZC5kZXRlY3RDb2xsaXNpb24odGhpcy50YWlsW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE5leHQoKTogRmllbGQge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY2FzZSBEaXJlY3Rpb24uVVA6XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmhlYWQueSAtIDEgPCAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZCh0aGlzLmhlYWQueCwgQ29uc3RhbnQuR0FNRV9IRUlHSFQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMuaGVhZC54LCB0aGlzLmhlYWQueSAtIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5SSUdIVDpcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaGVhZC54ICsgMSA+IENvbnN0YW50LkdBTUVfV0lEVEgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKDEsIHRoaXMuaGVhZC55KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZCh0aGlzLmhlYWQueCArIDEsIHRoaXMuaGVhZC55KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBEaXJlY3Rpb24uRE9XTjpcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuaGVhZC55ID09PSBDb25zdGFudC5HQU1FX0hFSUdIVCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQodGhpcy5oZWFkLngsIDEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMuaGVhZC54LCB0aGlzLmhlYWQueSArIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5MRUZUOlxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5oZWFkLnggLSAxID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZChDb25zdGFudC5HQU1FX1dJRFRILCB0aGlzLmhlYWQueSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQodGhpcy5oZWFkLngtMSwgdGhpcy5oZWFkLnkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXdGaWVsZChzbmFrZVBhcnQ6IEZpZWxkLCBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgc2l6ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgY3R4LmZpbGxSZWN0KChzbmFrZVBhcnQueCAtIDEpICogc2l6ZSwgKHNuYWtlUGFydC55IC0gMSkgKiBzaXplLCBzaXplLCBzaXplKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IEZpZWxkIH0gZnJvbSBcIi4vZmllbGRcIjtcclxuaW1wb3J0IHsgQ29uc3RhbnQgfSBmcm9tIFwiLi9jb25zdGFudFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZvb2QgZXh0ZW5kcyBGaWVsZCB7XHJcbiAgICBwdWJsaWMgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6dm9pZCB7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwiZ3JlZW5cIjtcclxuICAgICAgICBjdHguZmlsbFJlY3QoKHRoaXMueCAtIDEpICogQ29uc3RhbnQuRklFTERfU0laRSwgKHRoaXMueSAtIDEpICogQ29uc3RhbnQuRklFTERfU0laRSxDb25zdGFudC5GSUVMRF9TSVpFLCBDb25zdGFudC5GSUVMRF9TSVpFKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFNuYWtlIH0gZnJvbSBcIi4vc25ha2VcIjtcclxuaW1wb3J0IHsgRm9vZCB9IGZyb20gXCIuL2Zvb2RcIjtcclxuaW1wb3J0IHsgRGlyZWN0aW9uIH0gZnJvbSBcIi4vZGlyZWN0aW9uXCI7XHJcbmltcG9ydCB7IENvbnN0YW50IH0gZnJvbSBcIi4vY29uc3RhbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTbmFrZUdhbWUge1xyXG4gICAgcHVibGljIGZvb2QgOiBGb29kO1xyXG4gICAgcHJpdmF0ZSBzbmFrZSA6IFNuYWtlO1xyXG4gICAgcHJpdmF0ZSBjdHggOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgICBwcml2YXRlIHNjb3JlIDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHZhciBjYW52YXMgOiBIVE1MQ2FudmFzRWxlbWVudCA9IDxIVE1MQ2FudmFzRWxlbWVudD4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzbmFrZVwiKTtcclxuICAgICAgICB0aGlzLmN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgICAgIHRoaXMuc3RhcnROZXdHYW1lKCk7XHJcblxyXG4gICAgICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5uZXh0U3RlcCgpO1xyXG4gICAgICAgIH0sIENvbnN0YW50LkdBTUVfU1BFRUQpO1xyXG4gICAgICAgIHRoaXMua2V5Ym9hcmRJbnB1dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuZXh0U3RlcCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNuYWtlLm1vdmUoKTtcclxuICAgICAgICBpZih0aGlzLnNuYWtlLnNuYWtlU2xpZGVzSW50b0l0c2VsZigpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnROZXdHYW1lKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNuYWtlRm91bmRGb29kKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucGxhY2VOZXdGb29kKCk7XHJcbiAgICAgICAgdGhpcy5pbmNyZWFzZVNjb3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0TmV3R2FtZSgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNuYWtlID0gbmV3IFNuYWtlKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZm9vZCA9IG5ldyBGb29kKDQsIDQpO1xyXG4gICAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgICAgIHRoaXMuc2NvcmUgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGxhY2VOZXdGb29kKCk6IHZvaWQge1xyXG4gICAgICAgIHZhciB4IDogbnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKENvbnN0YW50LkdBTUVfV0lEVEggLSAxICsgMSkpICsgMTtcclxuICAgICAgICB2YXIgeSA6IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChDb25zdGFudC5HQU1FX0hFSUdIVCAtIDEgKyAxKSkgKyAxO1xyXG4gICAgICAgIHZhciBmb29kIDogRm9vZCA9IG5ldyBGb29kKHgsIHkpO1xyXG5cclxuICAgICAgICB3aGlsZSh0aGlzLnNuYWtlLnNuYWtlSXNOb3RIZXJlKGZvb2QpKSB7XHJcbiAgICAgICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoQ29uc3RhbnQuR0FNRV9XSURUSCAtIDEgKyAxKSkgKyAxO1xyXG4gICAgICAgICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKENvbnN0YW50LkdBTUVfSEVJR0hUIC0gMSArIDEpKSArIDE7XHJcbiAgICAgICAgICAgIGZvb2QgPSBuZXcgRm9vZCh4LCB5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZm9vZCA9IGZvb2Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbmNyZWFzZVNjb3JlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2NvcmUrKztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXcoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gXCJncmV5XCI7XHJcbiAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoMCwgMCwgQ29uc3RhbnQuR0FNRV9XSURUSCAqIENvbnN0YW50LkZJRUxEX1NJWkUsIENvbnN0YW50LkdBTUVfSEVJR0hUICogQ29uc3RhbnQuRklFTERfU0laRSk7XHJcbiAgICAgICAgdGhpcy5mb29kLmRyYXcodGhpcy5jdHgpO1xyXG4gICAgICAgIHRoaXMuc25ha2UuZHJhdyh0aGlzLmN0eCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBrZXlib2FyZElucHV0KCk6IHZvaWQge1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzcpIHtcclxuICAgICAgICAgICAgdGhpcy5zbmFrZS5jaGFuZ2VEaXJlY3Rpb24oRGlyZWN0aW9uLkxFRlQpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IDM4KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNuYWtlLmNoYW5nZURpcmVjdGlvbihEaXJlY3Rpb24uVVApO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IDM5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNuYWtlLmNoYW5nZURpcmVjdGlvbihEaXJlY3Rpb24uUklHSFQpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IDQwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNuYWtlLmNoYW5nZURpcmVjdGlvbihEaXJlY3Rpb24uRE9XTik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gaW5pdGlhbGl6ZSAmIHN0YXJ0IHRoZSBnYW1lXHJcbnZhciBHYW1lIDogU25ha2VHYW1lID0gbmV3IFNuYWtlR2FtZSgpO1xyXG5cclxuXHJcblxyXG4iXSwic291cmNlUm9vdCI6IiJ9